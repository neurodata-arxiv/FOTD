<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>ndstore ingest &vert; Neurodata FOTD</title>
<meta name="description" content="Learning how to ingest massive spatial volumes into the cloud at the tip of your fingers">
<meta name="keywords" content="ndstore, data">



<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="ndstore ingest">
<meta property="og:description" content="Learning how to ingest massive spatial volumes into the cloud at the tip of your fingers">
<meta property="og:url" content="http://localhost:4000/tutorials/ndstore-ingest">
<meta property="og:site_name" content="Neurodata FOTD">
<meta property="og:image" content="http://localhost:4000/images/kasthuri11.jpg">





<link rel="canonical" href="http://localhost:4000/tutorials/ndstore-ingest">
<link href="http://localhost:4000/feed.xml" type="application/atom+xml" rel="alternate" title="Neurodata FOTD Feed">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />


    <link href='http://fonts.googleapis.com/css?family=Montserrat:400,700|Open+Sans:400,600,300,800,700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/font-awesome.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/normalize.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/nprogress.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/vendor/foundation.min.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/style.css">
    <link rel="stylesheet" href="http://localhost:4000/assets/css/post.css">





<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://localhost:4000/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://localhost:4000/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://localhost:4000/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://localhost:4000/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://localhost:4000/images/apple-touch-icon-144x144-precomposed.png">

<style type="text/css">@media only screen and (min-width:43.75em){.notepad-post-content div>p:first-child:first-letter{float:left;font-size:4.688rem;line-height:4.375rem;padding-top:.25rem;padding-right:.5rem;padding-left:.188rem;font-family:serif}}</style>
</head>
<body class="post-template" itemscope itemtype="http://schema.org/WebPage">  
        <main id="notepad-post-container-simple" class="notepad-post-container-simple" role="main">
            <header class="notepad-post-header-simple">
                <div class="notepad-post-menu-header-simple">
                    <a class="notepad-blog-logo" href="http://localhost:4000">
                        <img src="http://localhost:4000/images/neurodata.png" alt="Blog Logo" /><h3 style="display:inline; color:#dfd6c2"> Neurodata's Figure of the Day</h3>
                    </a>

                <div class="notepad-blog-menu">      
    <div class="notepad-mobile-menu show-for-small">
        <a href="#"><i class="fa fa-bars"></i></a>
    </div>
    <ul class="notepad-menu">
        <li class="notepad-mobile-close-btn show-for-small text-right">
            <a href="#"><i class="fa fa-times"></i></a>
        </li>

            <li>
                    <a href="http://localhost:4000/">Home</a>
                 </li>
            
           <li><a href="http://localhost:4000/feed.xml" title="Atom/RSS feed"><i class="icon-rss"></i> Feed</a></li>
    </ul>

</div>
            </div>
                <div class="notepad-post-title-simple row">
                    <div class="small-12 columns">
                        <div class="notepad-post-meta-simple">
                            <h1>ndstore ingest</h1>
                            <p>by <strong>Neurodata</strong> &#8212; on <a href="http://localhost:4000/tags/index.html#ndstore" data-toggle="tooltip" title="Posts tagged with ndstore" rel="tag">ndstore</a>&nbsp;&comma;&nbsp;<a href="http://localhost:4000/tags/index.html#data" data-toggle="tooltip" title="Posts tagged with data" rel="tag">data</a> <strong><time datetime="2016-12-09T00:00:00-05:00">09 Dec 2016</time></strong></p>
                        </div>
                    </div>
                </div>
            </header>
        <article class="notepad-post-content post tag-simple">
            <div><h1 id="ingesting-3d-data-volumes-with-annotations-in-hdf5-format-to-ndstore">Ingesting 3D Data Volumes With Annotations in HDF5 Format to ndstore</h1>

<p>In this tutorial we will show you how to take a 3D image volume and 3D annotation volume and: create a dataset, project, tokens and channels, ingest the data, and verify the process was successful.</p>

<h3 id="step-1-prepare-your-data">Step 1: Prepare your data</h3>

<p>First ensure that your data is written to a properly formatted hdf5 volume. As an example, <a href="http://openconnecto.me/ocp/ca/kasthuri11/image/hdf5/3/1000,1300/2000,2200/1000,1200/">this link</a> provides a 300x200x200 tiff image of electron microscopy data, and <a href="http://openconnecto.me/ocp/ca/kat11segments/annotation/hdf5/3/1000,1300/2000,2200/1000,1200/">this link</a> provides annotations for the same region. Shown below are slices of this image:</p>

<p><img src="http://openconnecto.me/ocp/ca/kasthuri11/image/xy/3/1000,1300/2000,2200/1100/" alt="" />
<img src="http://openconnecto.me/ocp/ca/kat11segments/annotation/xy/3/1000,1300/2000,2200/1100/" alt="" /></p>

<h3 id="step-2-interogating-your-data">Step 2: Interogating your data</h3>

<p>In order to create a dataset, project, and channels for your data, you first need to understand several details of your data. Some of them can be found by interogating the images, while others require insight into the data acquisition (such as resolution, for instance).</p>

<p>The details which can be determined from your image are:</p>

<ul>
  <li>{x, y, z} image size</li>
  <li>time range</li>
  <li>data type</li>
  <li>window range</li>
</ul>

<p>The details which require information about your particular data are:</p>

<ul>
  <li>dataset name (no spaces or special characters)</li>
  <li>{x, y, z} offset</li>
  <li>scaling levels</li>
  <li>scaling option</li>
  <li>{x, y, z} voxel resolution</li>
</ul>

<p>A description of each of these fields is available <a href="http://docs.neurodata.io/ndstore/sphinx/datamodel.html#dataset-attributes">here</a>.</p>

<p>In order to determine the details of interest from our data in HDF5 format, we will use Python’s <code>h5py</code> library.</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s">'kasthuri11-image-hdf5-3-1000_1300-2000_2200-1000_1200-ocpcutout.h5'</span>
<span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">hf</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">np_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'CUTOUT'</span><span class="p">))</span>

<span class="k">print</span> <span class="s">'X image size: '</span><span class="p">,</span> <span class="n">np_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'Y image size: '</span><span class="p">,</span> <span class="n">np_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'Z image size: '</span><span class="p">,</span> <span class="n">np_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">print</span> <span class="s">'Time series: '</span><span class="p">,</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">np_data</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span>
    <span class="k">print</span> <span class="s">'Time range: (</span><span class="si">%</span><span class="s">d, </span><span class="si">%</span><span class="s">d)'</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">print</span> <span class="s">'Time range: (0, 0)'</span>
<span class="k">print</span> <span class="s">'Data type: '</span><span class="p">,</span> <span class="n">np_data</span><span class="o">.</span><span class="n">dtype</span>
<span class="k">print</span> <span class="s">'Window range: (</span><span class="si">%</span><span class="s">f, </span><span class="si">%</span><span class="s">f)'</span> <span class="o">%</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="nb">min</span><span class="p">(</span><span class="n">np_data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="nb">max</span><span class="p">(</span><span class="n">np_data</span><span class="p">))</span></code></pre></div>

<p class="notice">X image size:  200<br />
Y image size:  200<br />
Z image size:  300<br />
Time series:  False<br />
Time range: (0, 0)<br />
Data type:  uint8<br />
Window range: (0.000000, 254.000000)</p>

<p>Summarizing these results and those that must be determined with more intimate knowledge of the data, we come up with the following table:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">field</th>
      <th style="text-align: left">value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">dataset name</td>
      <td style="text-align: left">neurostorm_kat11_scale3</td>
    </tr>
    <tr>
      <td style="text-align: left">x size</td>
      <td style="text-align: left">200</td>
    </tr>
    <tr>
      <td style="text-align: left">y size</td>
      <td style="text-align: left">200</td>
    </tr>
    <tr>
      <td style="text-align: left">z size</td>
      <td style="text-align: left">300</td>
    </tr>
    <tr>
      <td style="text-align: left">time range</td>
      <td style="text-align: left">(0, 0)</td>
    </tr>
    <tr>
      <td style="text-align: left">data type</td>
      <td style="text-align: left">uint8</td>
    </tr>
    <tr>
      <td style="text-align: left">window range</td>
      <td style="text-align: left">(0, 254)</td>
    </tr>
    <tr>
      <td style="text-align: left">x offset</td>
      <td style="text-align: left">1000</td>
    </tr>
    <tr>
      <td style="text-align: left">y offset</td>
      <td style="text-align: left">2000</td>
    </tr>
    <tr>
      <td style="text-align: left">z offset</td>
      <td style="text-align: left">1000</td>
    </tr>
    <tr>
      <td style="text-align: left">scaling levels</td>
      <td style="text-align: left">0</td>
    </tr>
    <tr>
      <td style="text-align: left">scaling option</td>
      <td style="text-align: left">z-slices</td>
    </tr>
    <tr>
      <td style="text-align: left">x voxel resolution</td>
      <td style="text-align: left">32 nm</td>
    </tr>
    <tr>
      <td style="text-align: left">y voxel resolution</td>
      <td style="text-align: left">32 nm</td>
    </tr>
    <tr>
      <td style="text-align: left">z voxel resolution</td>
      <td style="text-align: left">40 nm</td>
    </tr>
  </tbody>
</table>

<h3 id="step-3--create-a-dataset">Step 3:  Create A Dataset</h3>

<p>Once you have this metadata about your images, you can begin the process of creating a dataset.</p>

<p>First, you should navigate to the server you wish to use (http://openconnecto.me/ocp/accounts/login/, for instance) and login (or register if you don’t have an account). Once you enter your login information, you will be able to select the <code>Datasets &gt; Create New Dataset</code> menu.</p>


            </div>
        </article>
        <div class="cf"></div>
        <div class="row text-center">
            <section class="notepad-post-share">
                <a class="twitter-icon" href="https://twitter.com/intent/tweet?text=&quot;ndstore ingest&quot;%20http://localhost:4000/tutorials/ndstore-ingest%20via%20&#64;"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;" title="Share on Twitter">
                    <i class="fa fa-twitter"></i>
                </a>
                <a class="facebook-icon" href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/tutorials/ndstore-ingest"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;" title="Share on Facebook">
                    <i class="fa fa-facebook"></i>
                </a>
                <a class="google-icon" href="https://plus.google.com/share?url=http://localhost:4000/tutorials/ndstore-ingest"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;" title="Share on Google+">
                    <i class="fa fa-google-plus"></i>
                </a>
            </section>
        </div>
        <div class="cf"></div>
        
 
        
        <div class="cf"></div>
        
        <section class="notepad-disqus row">
    <div class="small-12 columns">
        <h1 class="notepad-comments-header">Comments</h1>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ndata'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
</section>

        <div class="cf"></div>

    <footer class="notepad-site-footer">
    <div class="copyright">
         <section>All content copyright <a href="http://localhost:4000/about">Neurodata</a> &copy; 2016 &bull; All rights reserved.</section>
    </div>
    <div class="social-icons">
        
        
        
        
        
        <a href="http://github.com/neurodata">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-github fa-stack-1x"></i>
            </span>
        </a>
        
        
        <a href="http://facebook.com/neurodata.io">
            <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x fa-inverse"></i>
                <i class="fa fa-facebook fa-stack-1x"></i>
            </span>
        </a>
        
    </div>
    
    <div class="cf"></div>
</footer>
 
</main>    
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script>window.jQuery || document.write('<script src="http://localhost:4000/assets/js/vendor/jquery-1.11.1.min.js"><\/script>')</script>
    <script src="http://localhost:4000/assets/js/vendor/modernizr.js"></script>
    <script src="http://localhost:4000/assets/js/foundation.min.js"></script>
    <script src="http://localhost:4000/assets/js/notepad.js"></script>
    <script src="http://localhost:4000/assets/js/scripts.min.js"></script>
    <script src="http://localhost:4000/assets/js/vendor/nprogress.js"></script>
		<script src="https://use.fontawesome.com/72eacbfadb.js"></script>
    <script>
      $(document).foundation();
    </script>


<script>NProgress.start();var interval=setInterval(function(){NProgress.inc()},1000);jQuery(window).load(function(){clearInterval(interval);NProgress.done()});jQuery(window).unload(function(){NProgress.start()});</script>
 
</body>
</html>
